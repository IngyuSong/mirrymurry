<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<th:block layout:fragment="script">
    <script th:inline="javascript">
    $.datepicker.setDefaults({
        dateFormat:'yy-mm-dd',
        prevText: '이전 달',
        nextText: '다음 달',
        monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
        monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
        dayNames: ['일', '월', '화', '수', '목', '금', '토'],
        dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
        dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
        showMonthAfterYear: true,
        yearSuffix: '년'
    });

    $(function(){
        $('.datepicker').datepicker();

        $(".datepicker").val();

        $(".datepicker").on("change",function(){
            $("#bookList").empty();
            var selected = $(this).val();
            $.ajax({
                method:"GET",
                url: "/stores/bookDate/1",
                data :  {
                    "bookDate" : selected
                },
                contentType: "application/x-www-form-urlencoded; charset=UTF-8;"
                })
                .done(function(response){
                    console.log("Date success");
                    if(response.length > 0) {
                        for(var bookMngList of response) {
                        $("#bookList").append(
                            "<tr>" +
                                "<td>"+bookMngList.user_name+"</td>" +
                                "<td>"+bookMngList.email+"</td>" +
                                "<td>"+bookMngList.phone_number+"</td>" +
                                "<td>"+bookMngList.bookDate+"</td>" +
                                "<td><button class=\"btn btn-danger\" value=\""+bookMngList.book_id+"\" onclick=\"bookCancel(this.value)\">취소</button></td>" +
                            "</tr>"
                        );
                    }
                    }

                });
        });
    })

        function bookOk(book_id){
        console.log("clicked");
        console.log(book_id);
        var bookId = book_id;

            $.ajax({
                method:"GET",
                url: "/stores/bookOk",
                data :  {
                    "book_id" : bookId
                },
                contentType: "application/x-www-form-urlencoded; charset=UTF-8;"
            })
            .done(function(response){
                console.log("success");
                location.href="/stores/bookMng/1";
            });
        }

        function bookCancel(book_id){
        console.log("clicked");
        console.log(book_id);
        var bookId = book_id;

            $.ajax({
                method:"GET",
                url: "/stores/bookCancel",
                data :  {
                    "book_id" : bookId
                },
                contentType: "application/x-www-form-urlencoded; charset=UTF-8;"
            })
            .done(function(response){
                alert("예약이 취소되었습니다.");
                location.href="/stores/bookMng/1";
            });
        }


    </script>
</th:block>
<!-- 사용자 CSS 추가 -->
<th:block layout:fragment="css">
    <style>
    </style>
</th:block>

<div layout:fragment="content">

    <h2>예약관리</h2>
    <h5>예약 날짜</h5>
    <div>
        <input class="datepicker" id="bookDate" name="bookDate">
    </div>

    <h5>예약 목록</h5>
    <table id="bookList">

    </table>
</div>
</html>